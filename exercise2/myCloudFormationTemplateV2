{
    "Metadata": {
        "AWS::CloudFormation::Designer": {
            "f98b2cb4-efa5-4af9-882e-359787f155a3": {
                "size": {
                    "width": 860,
                    "height": 410
                },
                "position": {
                    "x": 750,
                    "y": 810
                },
                "z": 0,
                "embeds": [
                    "2cb6ece9-f72f-4532-b2a5-85a77e9c530f",
                    "5c719f22-025f-4205-bcd8-ad4fa4950f7d",
                    "9691a5d7-645a-4bb4-85d8-df7e8f3d4667"
                ]
            },
            "9691a5d7-645a-4bb4-85d8-df7e8f3d4667": {
                "size": {
                    "width": 430,
                    "height": 330
                },
                "position": {
                    "x": 1140,
                    "y": 840
                },
                "z": 1,
                "parent": "f98b2cb4-efa5-4af9-882e-359787f155a3",
                "embeds": [
                    "4734cb2b-fbbb-4d32-a4fe-27fbe3f6fe2d",
                    "e5d92f07-fc3b-4cfa-b32c-eaa8777b82c0",
                    "40c46d66-28b2-48ec-843f-95737bcd6d1c",
                    "c48020e8-fb7b-4865-b954-14b433c480b7",
                    "cca4257e-497b-4ef5-a4a9-64ae14a0e12d",
                    "1548ec77-1f03-48dd-96d7-a2b435ae350f",
                    "8eb68b0e-fde1-4350-b64c-9ec350104125",
                    "e5d78b3b-f8d5-4cb1-93eb-824ec1dcfa38"
                ]
            },
            "1548ec77-1f03-48dd-96d7-a2b435ae350f": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1470,
                    "y": 890
                },
                "z": 2,
                "parent": "9691a5d7-645a-4bb4-85d8-df7e8f3d4667",
                "embeds": [],
                "isconnectedto": [
                    "de1fad30-ae96-4261-b71e-0d5b1eec7e7a"
                ],
                "isassociatedwith": [
                    "cca4257e-497b-4ef5-a4a9-64ae14a0e12d"
                ]
            },
            "cca4257e-497b-4ef5-a4a9-64ae14a0e12d": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1370,
                    "y": 890
                },
                "z": 2,
                "parent": "9691a5d7-645a-4bb4-85d8-df7e8f3d4667",
                "embeds": []
            },
            "8f019711-7932-496e-a187-6a39332293b1": {
                "source": {
                    "id": "1548ec77-1f03-48dd-96d7-a2b435ae350f"
                },
                "target": {
                    "id": "cca4257e-497b-4ef5-a4a9-64ae14a0e12d"
                },
                "z": 3
            },
            "c48020e8-fb7b-4865-b954-14b433c480b7": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1470,
                    "y": 970
                },
                "z": 2,
                "parent": "9691a5d7-645a-4bb4-85d8-df7e8f3d4667",
                "embeds": [],
                "isconnectedto": [
                    "4918e21e-5c92-4a06-901c-57adc5788726"
                ],
                "isassociatedwith": [
                    "40c46d66-28b2-48ec-843f-95737bcd6d1c"
                ]
            },
            "40c46d66-28b2-48ec-843f-95737bcd6d1c": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1370,
                    "y": 970
                },
                "z": 2,
                "parent": "9691a5d7-645a-4bb4-85d8-df7e8f3d4667",
                "embeds": []
            },
            "cc04e533-1e78-4202-9911-ececb951802f": {
                "source": {
                    "id": "c48020e8-fb7b-4865-b954-14b433c480b7"
                },
                "target": {
                    "id": "40c46d66-28b2-48ec-843f-95737bcd6d1c"
                },
                "z": 3
            },
            "de1fad30-ae96-4261-b71e-0d5b1eec7e7a": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1650,
                    "y": 890
                },
                "z": 0,
                "embeds": []
            },
            "4918e21e-5c92-4a06-901c-57adc5788726": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1650,
                    "y": 970
                },
                "z": 0,
                "embeds": []
            },
            "a1763c83-9779-441d-b147-d63980cb3f5c": {
                "source": {
                    "id": "c48020e8-fb7b-4865-b954-14b433c480b7"
                },
                "target": {
                    "id": "4918e21e-5c92-4a06-901c-57adc5788726"
                },
                "z": 3
            },
            "a14b71df-6f2e-43a0-9466-0b3e61a786b4": {
                "source": {
                    "id": "1548ec77-1f03-48dd-96d7-a2b435ae350f"
                },
                "target": {
                    "id": "de1fad30-ae96-4261-b71e-0d5b1eec7e7a"
                },
                "z": 4
            },
            "e5d78b3b-f8d5-4cb1-93eb-824ec1dcfa38": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1470,
                    "y": 1070
                },
                "z": 2,
                "parent": "9691a5d7-645a-4bb4-85d8-df7e8f3d4667",
                "embeds": [],
                "ismemberof": [
                    "4e2d323d-6f57-4069-adea-d5facb0c9a63"
                ]
            },
            "4e2d323d-6f57-4069-adea-d5facb0c9a63": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1650,
                    "y": 1070
                },
                "z": 0,
                "embeds": []
            },
            "b1606ebc-eba0-4181-8b73-2d7190f9f44d": {
                "source": {
                    "id": "e5d78b3b-f8d5-4cb1-93eb-824ec1dcfa38"
                },
                "target": {
                    "id": "4e2d323d-6f57-4069-adea-d5facb0c9a63"
                },
                "z": 5
            },
            "5c719f22-025f-4205-bcd8-ad4fa4950f7d": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 860,
                    "y": 870
                },
                "z": 1,
                "parent": "f98b2cb4-efa5-4af9-882e-359787f155a3",
                "embeds": []
            },
            "2cb6ece9-f72f-4532-b2a5-85a77e9c530f": {
                "size": {
                    "width": 180,
                    "height": 160
                },
                "position": {
                    "x": 800,
                    "y": 1000
                },
                "z": 1,
                "parent": "f98b2cb4-efa5-4af9-882e-359787f155a3",
                "embeds": [
                    "fd4c10d1-0c09-43d5-a5d8-79ecb5371fb6"
                ]
            },
            "fd4c10d1-0c09-43d5-a5d8-79ecb5371fb6": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 860,
                    "y": 1050
                },
                "z": 2,
                "parent": "2cb6ece9-f72f-4532-b2a5-85a77e9c530f",
                "embeds": [],
                "ismemberof": [
                    "594a4af0-69dc-4101-bc58-3d0d4dc68a0b"
                ]
            },
            "594a4af0-69dc-4101-bc58-3d0d4dc68a0b": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 650,
                    "y": 1050
                },
                "z": 0,
                "embeds": []
            },
            "439b3761-a109-491a-8442-48c81f7a3ea6": {
                "source": {
                    "id": "fd4c10d1-0c09-43d5-a5d8-79ecb5371fb6"
                },
                "target": {
                    "id": "594a4af0-69dc-4101-bc58-3d0d4dc68a0b"
                },
                "z": 3
            },
            "8eb68b0e-fde1-4350-b64c-9ec350104125": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1370,
                    "y": 1070
                },
                "z": 2,
                "parent": "9691a5d7-645a-4bb4-85d8-df7e8f3d4667",
                "embeds": [],
                "isrelatedto": [
                    "e5d92f07-fc3b-4cfa-b32c-eaa8777b82c0"
                ]
            },
            "e5d92f07-fc3b-4cfa-b32c-eaa8777b82c0": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1260,
                    "y": 1070
                },
                "z": 2,
                "parent": "9691a5d7-645a-4bb4-85d8-df7e8f3d4667",
                "embeds": []
            },
            "4b5fb1a9-1276-413d-b9b6-6375d435b3ae": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1370,
                    "y": 1300
                },
                "z": 1,
                "parent": "f5e3fefc-d6ba-47a2-abd3-44bb80885128",
                "embeds": [],
                "isrelatedto": [
                    "8eb68b0e-fde1-4350-b64c-9ec350104125"
                ]
            },
            "aa80b530-e30c-4f8e-9bf7-d532c40328ad": {
                "source": {
                    "id": "8eb68b0e-fde1-4350-b64c-9ec350104125"
                },
                "target": {
                    "id": "e5d92f07-fc3b-4cfa-b32c-eaa8777b82c0"
                },
                "z": 3
            },
            "f5e3fefc-d6ba-47a2-abd3-44bb80885128": {
                "size": {
                    "width": 140,
                    "height": 140
                },
                "position": {
                    "x": 1330,
                    "y": 1260
                },
                "z": 0,
                "embeds": [
                    "4b5fb1a9-1276-413d-b9b6-6375d435b3ae"
                ]
            },
            "4734cb2b-fbbb-4d32-a4fe-27fbe3f6fe2d": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 1270,
                    "y": 890
                },
                "z": 2,
                "parent": "9691a5d7-645a-4bb4-85d8-df7e8f3d4667",
                "embeds": []
            }
        }
    },
    "Parameters": {
        "SSHLocation": {
            "Description": "Lockdown SSH access to the bastion host (default can be accessed from anywhere)",
            "Type": "String",
            "MinLength": "9",
            "MaxLength": "18",
            "Default": "0.0.0.0/0",
            "AllowedPattern": "(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})",
            "ConstraintDescription": "must be a valid CIDR range of the form x.x.x.x/x."
        },
        "KeyName": {
            "Description": "Name of an existing EC2 KeyPair to enable SSH access to the instances",
            "Type": "AWS::EC2::KeyPair::KeyName",
            "ConstraintDescription": "must be the name of an existing EC2 KeyPair."
        },
        "InstanceType": {
            "Description": "WebServer EC2 instance type",
            "Type": "String",
            "Default": "t2.micro",
            "AllowedValues": [
                "t1.micro",
                "t2.nano",
                "t2.micro",
                "t2.small",
                "m1.small",
                "m3.medium",
                "c1.medium"
            ],
            "ConstraintDescription": "must be a valid EC2 instance type."
        }
    },
    "Resources": {
        "OurVPC": {
            "Type": "AWS::EC2::VPC",
            "Properties": {
                "CidrBlock": "10.0.0.0/16"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "f98b2cb4-efa5-4af9-882e-359787f155a3"
                }
            }
        },
        "OurSubnet": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "OurVPC"
                },
                "CidrBlock": "10.0.1.0/24"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "9691a5d7-645a-4bb4-85d8-df7e8f3d4667"
                }
            }
        },
        "FTPASG": {
            "Type": "AWS::AutoScaling::AutoScalingGroup",
            "Properties": {
                "LaunchConfigurationName": {
                    "Ref": "FTPLC"
                },
                "LoadBalancerNames": [
                    {
                        "Ref": "FTPELB"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "1548ec77-1f03-48dd-96d7-a2b435ae350f"
                }
            }
        },
        "FTPLC": {
            "Type": "AWS::AutoScaling::LaunchConfiguration",
            "Properties": {
                "KeyName": {
                    "Ref": "KeyName"
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "cca4257e-497b-4ef5-a4a9-64ae14a0e12d"
                }
            }
        },
        "LAMPASG": {
            "Type": "AWS::AutoScaling::AutoScalingGroup",
            "Properties": {
                "LaunchConfigurationName": {
                    "Ref": "LAMPLC"
                },
                "LoadBalancerNames": [
                    {
                        "Ref": "LAMPELB"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "c48020e8-fb7b-4865-b954-14b433c480b7"
                }
            }
        },
        "LAMPLC": {
            "Type": "AWS::AutoScaling::LaunchConfiguration",
            "Properties": {
                "KeyName": {
                    "Ref": "KeyName"
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "40c46d66-28b2-48ec-843f-95737bcd6d1c"
                }
            }
        },
        "FTPELB": {
            "Type": "AWS::ElasticLoadBalancing::LoadBalancer",
            "Properties": {},
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "de1fad30-ae96-4261-b71e-0d5b1eec7e7a"
                }
            }
        },
        "LAMPELB": {
            "Type": "AWS::ElasticLoadBalancing::LoadBalancer",
            "Properties": {},
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "4918e21e-5c92-4a06-901c-57adc5788726"
                }
            }
        },
        "MgtBox": {
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "KeyName": {
                    "Ref": "KeyName"
                },
                "SubnetId": {
                    "Ref": "OurSubnet"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "MgtBoxSG"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "e5d78b3b-f8d5-4cb1-93eb-824ec1dcfa38"
                }
            }
        },
        "MgtBoxSG": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "22",
                        "ToPort": "22",
                        "CidrIp": {
                            "Ref": "SSHLocation"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "4e2d323d-6f57-4069-adea-d5facb0c9a63"
                }
            }
        },
        "S3BHPID": {
            "Type": "AWS::S3::Bucket",
            "Properties": {},
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "5c719f22-025f-4205-bcd8-ad4fa4950f7d"
                }
            }
        },
        "DBSubnet": {
            "Type": "AWS::RDS::DBSubnetGroup",
            "Properties": {},
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "2cb6ece9-f72f-4532-b2a5-85a77e9c530f"
                }
            }
        },
        "MasterDB": {
            "Type": "AWS::RDS::DBInstance",
            "Properties": {
                "DBSubnetGroupName": {
                    "Ref": "DBSubnet"
                },
                "VPCSecurityGroups": [
                    {
                        "Ref": "MasterDBSG"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "fd4c10d1-0c09-43d5-a5d8-79ecb5371fb6"
                }
            }
        },
        "MasterDBSG": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {},
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "594a4af0-69dc-4101-bc58-3d0d4dc68a0b"
                }
            }
        },
        "OurNATGateway": {
            "Type": "AWS::EC2::NatGateway",
            "Properties": {
                "AllocationId": {
                    "Fn::GetAtt": [
                        "OurElasticIP",
                        "AllocationId"
                    ]
                },
                "SubnetId": {
                    "Ref": "OurSubnet"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "8eb68b0e-fde1-4350-b64c-9ec350104125"
                }
            }
        },
        "OurElasticIP": {
            "Type": "AWS::EC2::EIP",
            "Properties": {
                "Domain": "OurVPC"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "e5d92f07-fc3b-4cfa-b32c-eaa8777b82c0"
                }
            }
        },
        "OurRoute": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "RouteTableId": {
                    "Ref": "OurRouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "NatGatewayId": {
                    "Ref": "OurNATGateway"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "4b5fb1a9-1276-413d-b9b6-6375d435b3ae"
                }
            }
        },
        "OurRouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {},
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "f5e3fefc-d6ba-47a2-abd3-44bb80885128"
                }
            }
        },
        "EFSFS3NIMU": {
            "Type": "AWS::EFS::FileSystem",
            "Properties": {},
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "4734cb2b-fbbb-4d32-a4fe-27fbe3f6fe2d"
                }
            }
        }
    }
}